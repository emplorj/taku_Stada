<!DOCTYPE html>
<html lang="ja">

<head>
    <meta name="robots" content="noindex">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>卓スタダ</title>
    <!-- OGP (Open Graph Protocol) / Twitter Card -->
    <meta property="og:title" content="卓スタダ" />
    <meta property="og:description" content="TRPGのセッション運営を支援するためのツールや情報をまとめたサイトです。" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://emplorj.github.io/taku_Stada/index.html" />
    <link rel="stylesheet" href="css/style.css">
    <!-- Font Awesomeは全ページで使う可能性があるのでここに残す -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>

<body>
    <div id="header-placeholder"></div>
    <canvas id="particleCanvas"></canvas>

    <div class="main-content">
        <header class="main-header">
            <h1>卓スタダ</h1>
            <p class="subtitle">いままでの犯行</p>
        </header>

        <div class="logo-container">
            <img src="img/卓スタダロゴ.png" alt="卓スタダロゴ" class="logo-image">
            <img src="img/卓スタダminiロゴ.png" alt="卓スタダミニロゴ" class="logo-image mini">
        </div>

        <h2 id="coc-qa-section" class="section-title start-title"><a href="CoC_Q&A.html">✨ クトゥルフ神話TRPG シナリオスタダ</a></h2>
        <div class="plain-text-block intro-block">
            <p>クトゥルフ神話TRPGシナリオ作成に悩むあなたへ、<a href="https://twitter.com/haisuikan_trpg" target="_blank"
                    class="plain-text-author-link"
                    rel="noopener noreferrer">はいすいかん(@haisuikan_trpg)</a>さんからのアドバイスをまとめました。</p>
            <p>「どんな神話生物を使えばいいの？」「ストーリーの組み立て方が分からない！」といった疑問を解決し、自作シナリオを回そう！</p>
        </div>

        <h2 id="schedule-section" class="section-title start-title"><a href="schedule.html">📅 予定</a></h2>
        <div class="plain-text-block intro-block">
            <p>今後のセッション予定などを確認できます。</p>
            <a href="https://character-sheets.appspot.com/schedule/list?key=ahVzfmNoYXJhY3Rlci1zaGVldHMtbXByHAsSEkRpc2NvcmRTZXNzaW9uRGF0YRimu5y4BQw"
                target="_blank" rel="noopener noreferrer">デイコード</a>： 予定の入力を行う</li>
        </div>

        <h2 id="slides-section" class="section-title start-title"><a href="slides.html">📖 スライド置き場</a></h2>
        <div class="plain-text-block intro-block">
            <p>TRPGのルール説明スライドとかを雑に置いとく場所。</p>
            <p>「これどんなんだっけ？」って時にでも見てってや。</p>
            <ul class="link-list">
                <li><a href="https://docs.google.com/presentation/d/e/2PACX-1vSOxfzmGJTdTEXXiXOHIxlueVIfbG9Xuq8NSrv0wrgwLUHV84OfLRcyU-I0WjLSXYFfMJEfcubHJ9KR/pub?start=false&loop=true&delayms=3000"
                        target="_blank" rel="noopener noreferrer">はじめよう　クトゥルフ神話RPG</a></li>
                <li><a href="https://docs.google.com/presentation/d/e/2PACX-1vTkciQV57Bo7Jzgk85SmrG9JJPMXjaGHYweGxTQhWbeWzD5bKzkcvzBeFQXn1EHwRdM7mHVGpoeI3g4/pub?start=false&loop=false&delayms=3000"
                        target="_blank" rel="noopener noreferrer">はじめよう　ソード・ワールド2.5</a></li>
                <li><a href="https://docs.google.com/presentation/d/e/2PACX-1vRwmLeSj3YfrpHtB158EME-vQ1LbzuB3cnVfqAmJkAvcvqvv84Yk7U8dGk8Cjw79WVL7ixOETUosDXU/pub?start=false&loop=false&delayms=3000"
                        target="_blank" rel="noopener noreferrer">はじめよう ダブルクロス3rd</a></li>
                <li><a href="https://docs.google.com/presentation/d/e/2PACX-1vTTJMqZnvl2aLEbSvDq0lGRIQWkYAL2KsMgworFsdvdzo9KcAiKJtoyhU2Mt6SFZsuZfV7-rMHcd0_U/pub?start=false&loop=false&delayms=3000"
                        target="_blank" rel="noopener noreferrer">はじめよう ネクロニカ</a></li>
            </ul>
        </div>

        <div class="plain-text-block additional-info-section">
            <h2 id="archive-section">◆アーカイブ</h2>
            <ul>
                <li><a href="https://docs.google.com/spreadsheets/d/17wStGJ37GjaINrjZMFZgmacYOPeH9F8ZiahhtJd_nxI/"
                        target="_blank" rel="noopener noreferrer">スプレッドシート</a>: 卓の履歴や、キャラのまとめ、PLの所持ルールブックなんかをここに記す</li>
                <li><a href="https://www.dropbox.com/scl/fo/lnuvslrnsqqyye3ka3dfa/APfMlkTTNNrt9Lgnx5sOOVA?rlkey=t5ltutxf80yqz8p499dae7loj&dl=0"
                        target="_blank" rel="noopener noreferrer">ログ置き場（Dropbox）</a>
                    <p style="font-size: 0.9em; margin-top: 0.3em;">終わったシナリオのログが一元的にみられたらいいねってところ。(Discord: <a
                            href="https://discord.com/channels/641914997894807552/1212090718387044503" target="_blank"
                            rel="noopener noreferrer">該当チャンネル</a>)</p>
                </li>
            </ul>
        </div>

        <div class="plain-text-block additional-info-section">
            <h2 id="char-qa-sheet-section">◆あなたのキャラへの質問一覧シート</h2>
            <ul>
                <li><a href="q_and_a.html">キャラクターQ&Aページ</a>: ここでキャラクターの回答を閲覧・新規登録できます。</li>
                <li><a href="https://docs.google.com/spreadsheets/d/1RJrUdz6QbYc_N1X0gub8zdixEIy_8KyV3exf6A9Smoc/edit?gid=0"
                        target="_blank" rel="noopener noreferrer">Googleスプレッドシート（元データ）</a>: キャラクターへの理解を深めるための質問集です。</li>
            </ul>
        </div>

        <div class="plain-text-block additional-info-section">
            <h2 id="ccfolia-tools-section">◆ココフォリアツール</h2>
            <ul class="tool-card-list" id="tool-card-list-container">
                <!-- ここにJavaScriptでOGPカードが挿入されます -->
            </ul>
        </div>

        <div class="plain-text-block additional-info-section">
            <h2 id="content-policy-section">地雷チェックシート</h2>
            <p>セッション前に参加者間の認識を合わせるため、弊社では規定のものとして下記シートの使用を推奨しています。</p>
            <ul class="works-list" style="justify-content: flex-start; margin-top: 20px;">
                <li class="works-card">
                    <a href="https://booth.pm/ja/items/3432975" target="_blank" rel="noopener noreferrer">
                        <img src="https://booth.pximg.net/c/300x300_a2_g5/6852d26d-e396-4782-b31c-192ad0dac15b/i/3432975/df64c1c0-d649-43e6-827b-8e8d4a463ad9_base_resized.jpg"
                            alt="細かすぎる地雷チェックシート サムネイル" class="works-thumb">
                        <div class="works-details">
                            <h4 class="works-title">細かすぎる<br>地雷チェックシート</h4>
                            <p class="works-description">これを使うと良い</p>
                        </div>
                    </a>
                </li>
            </ul>
        </div>

        <div class="plain-text-block additional-info-section">
            <h2 id="color-codes-section">スタダのキャラ紹介とかで、共通規格として用いているTRPGシステムと色の組み合わせ</h2>
            <ul class="color-code-list" id="trpg-color-list"></ul>
            <p>Q.普通の青って使わないん？<br>A. その他が青になりがち。</p>
        </div>

        <div class="plain-text-block additional-info-section">
            <h2 id="yutosheet-template-section"><a href="https://yutorize.2-d.jp/" target="_blank"
                    rel="noopener noreferrer">ゆとシート</a>用パーソナル情報テンプレ
            </h2>
            <p>お手持ちのゆとシートの「容姿・経歴」とか「その他」とかの枠にでも付け加えてもらえると助かります<br>
                入れたい情報に沿って、同じ形式で情報を追加してってください（好きなものとか、弱点とか！）</p>
            <div class="code-block-container">
                <pre class="code-block" id="yutosheet-template"><code>[>]**パーソナルデータ
:性別|
:身長|
:体重|
:年齢|
: 髪 |
: 瞳 |
: 肌 |
[---]</code></pre>
                <button class="copy-button" onclick="copyCodeToClipboard('yutosheet-template')">コピー</button>
            </div>
        </div>

        <footer>
            <p>© 2025 卓スタダ.</p>
        </footer>
    </div>

    <button onclick="topFunction()" id="backToTopBtn" title="トップへ戻る">▲</button>
    <script src="js/common.js"></script>

    <script>
        // ★★★★★ index.html 専用のスクリプトをここに記述 ★★★★★

        document.addEventListener('DOMContentLoaded', function () {
            // --- 色リスト生成 ---
            const colorListContainer = document.getElementById('trpg-color-list');
            if (colorListContainer && typeof TRPG_SYSTEM_COLORS !== 'undefined') {
                const systemsToShow = [
                    { displayName: 'クトゥルフ神話TRPG', colorNameDesc: '緑', systemKey: 'CoC' }, { displayName: 'クトゥルフ神話TRPG(秘匿)', colorNameDesc: '濃緑', systemKey: 'CoC-㊙' },
                    { displayName: 'ソード・ワールド2.5', colorNameDesc: '薄赤', systemKey: 'SW' }, { displayName: 'ダブルクロス The 3rd Edition', colorNameDesc: '赤', systemKey: 'DX3' },
                    { displayName: '永い後日談のネクロニカ', colorNameDesc: '灰', systemKey: 'ネクロニカ' }, { displayName: 'サタスペ', colorNameDesc: 'オレンジ', systemKey: 'サタスペ' },
                    { displayName: 'マモノスクランブル', colorNameDesc: '黄橙', systemKey: 'マモブル' }, { displayName: '銀剣のステラナイツ', colorNameDesc: '暗い青', systemKey: '銀剣' },
                    { displayName: 'ウマ娘TRPG', colorNameDesc: '桃', systemKey: 'ウマ娘' }, { displayName: 'シノビガミ', colorNameDesc: '紫', systemKey: 'シノビガミ' },
                    { displayName: 'アリアンロッドRPG 2E', colorNameDesc: '黄色', systemKey: 'AR' }
                ];
                systemsToShow.forEach(sys => {
                    const colorCode = TRPG_SYSTEM_COLORS[sys.systemKey] || TRPG_SYSTEM_COLORS['default'];
                    const listItem = document.createElement('li');
                    listItem.classList.add('color-list-item');
                    listItem.innerHTML = `<span class="color-list-text">${sys.displayName}：（${sys.colorNameDesc}）</span> <span class="color-chip" style="background-color: ${colorCode};"></span> <code>${colorCode}</code> <button class="copy-color-button" data-colorcode="${colorCode}" title="カラーコードをコピー">コピー</button>`;
                    colorListContainer.appendChild(listItem);
                });
                colorListContainer.addEventListener('click', function (event) {
                    const button = event.target.closest('.copy-color-button');
                    if (button) {
                        navigator.clipboard.writeText(button.dataset.colorcode).then(() => {
                            const originalText = button.textContent; button.textContent = 'OK!'; button.disabled = true;
                            setTimeout(() => { button.textContent = originalText; button.disabled = false; }, 1500);
                        });
                    }
                });
            }

        });

        // --- OGPカードリスト生成 ---
        const toolData = [
            { url: "https://ccfolia.com/rooms/6584j5uuj", title: "楽屋ココフォリア", author: "おれ・ココフォリア" },
            { url: "https://kurian.websozai.jp/charaPiece/top", title: "キャラシコピペツール (CoC, SW等)", author: "クウリャン様" },
            { url: "https://script.google.com/macros/s/AKfycbwUPjuiBEGUrfrKcKZCrRAqiB7V687tbA5uxy7PbKxSkgMGnoIMob7yK0PNEvBoUcbTTA/exec", title: "キャラシコピペツール (DX3rd, サタスペ等)", author: "おれ" },
            { url: "https://docs.google.com/spreadsheets/d/1jMnjoqxiJZanm6L9-HsXw1crxBdQB_SZQgM4O8Tk7MM/", title: "ダブルクロス コンボジェネレーター", author: "おれ" },
            { url: "https://docs.google.com/presentation/d/1ZHHNs_yR37joGYSBiYfQ_C_mwmhdFNHmxkA7fItBkKs/edit#slide=id.g2710a927f4d_0_5", title: "ダブルクロス コンボジェネレーター (説明)", author: "おれ" },
            { url: "https://docs.google.com/spreadsheets/d/1MifivHkro_g2S_9QFYJoCa4eBaSNw-JqoEexGCEr41w/edit?usp=sharing", title: "シナリオテンプレ／CoC（あばれぢから）", author: "あばれぢから" },
            { url: "https://sirubedon.github.io/TextConverter/", title: "テキストコンバーター", author: "しるべ" },
            { url: "https://sirubedon.github.io/ccfolia-log-to-xlsx/", title: "ココフォリアログ→Excel変換", author: "しるべ" },
            { url: "https://sirubedon.github.io/CCfoliaLogConverterWithImages/", title: "ココフォリア/Tekeyログ整形 (画像埋込)", author: "しるべ" },
            { url: "https://x.com/qxoiUioxp/status/1898323502731796480", title: "動画→動く画像(APNG)変換", author: "しるべ" }
        ];

        const toolCardContainer = document.getElementById('tool-card-list-container');

        if (toolCardContainer) {
            const groupedByAuthor = toolData.reduce((acc, tool) => {
                const author = tool.author || 'その他';
                if (!acc[author]) acc[author] = [];
                acc[author].push(tool);
                return acc;
            }, {});

            for (const author in groupedByAuthor) {
                const authorHeader = document.createElement('h3');
                authorHeader.className = 'tool-author-header';
                authorHeader.textContent = author;
                toolCardContainer.appendChild(authorHeader);

                const authorToolList = document.createElement('ul');
                authorToolList.className = 'tool-card-list';

                groupedByAuthor[author].forEach(tool => {
                    const wrapper = document.createElement('li');
                    wrapper.className = 'ogp-card-wrapper';

                    const originalTitle = document.createElement('h4');
                    originalTitle.className = 'ogp-card-original-title';
                    originalTitle.textContent = tool.title;
                    wrapper.appendChild(originalTitle);

                    const cardPlaceholder = document.createElement('div');
                    cardPlaceholder.className = 'ogp-card';
                    cardPlaceholder.innerHTML = `<a href="${tool.url}" target="_blank" rel="noopener noreferrer"><div class="ogp-card-content"><p>読み込み中...</p></div></a>`;
                    wrapper.appendChild(cardPlaceholder);

                    authorToolList.appendChild(wrapper);

                    fetchOgpData(tool.url, cardPlaceholder);
                });
                toolCardContainer.appendChild(authorToolList);
            }
        }

        async function fetchOgpData(url, placeholderElement) {
            const defaultImage = 'img/icon.png';
            try {
                const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`);
                const html = await response.text();

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const getMetaContent = (prop, attr = 'property') => {
                    const el = doc.querySelector(`meta[${attr}="${prop}"]`);
                    return el ? el.getAttribute('content') : '';
                };

                const title = getMetaContent('og:title') || doc.querySelector('title')?.textContent || 'タイトル不明';
                const description = getMetaContent('og:description') || getMetaContent('description', 'name') || '';
                let imageUrl = getMetaContent('og:image');

                // 相対URLを絶対URLに変換
                if (imageUrl && !imageUrl.startsWith('http')) {
                    const urlObj = new URL(url);
                    imageUrl = new URL(imageUrl, urlObj.origin).href;
                }

                const displayUrl = new URL(url).hostname;

                const cardHtml = `
                    <a href="${url}" target="_blank" rel="noopener noreferrer">
                        <div class="ogp-card-image">
                            <img src="${imageUrl || defaultImage}" alt="サイトのプレビュー画像" onerror="this.onerror=null;this.src='img/icon.png';">
                        </div>
                        <div class="ogp-card-content">
                            <h4 class="ogp-card-title">${title}</h4>
                            <p class="ogp-card-description">${description}</p>
                            <span class="ogp-card-url">${displayUrl}</span>
                        </div>
                    </a>
                `;
                placeholderElement.innerHTML = cardHtml;

            } catch (error) {
                console.error('OGP取得エラー:', url, error);
                const displayUrl = new URL(url).hostname;
                const errorHtml = `
                    <a href="${url}" target="_blank" rel="noopener noreferrer">
                        <div class="ogp-card-image">
                            <img src="img/icon.png" alt="サイトのプレビュー画像">
                        </div>
                        <div class="ogp-card-content">
                            <h4 class="ogp-card-title">${displayUrl}</h4>
                            <p class="ogp-card-description">情報の取得に失敗しました。</p>
                            <span class="ogp-card-url">${displayUrl}</span>
                        </div>
                    </a>
                `;
                placeholderElement.innerHTML = errorHtml;
            }
        }



    </script>
</body>

</html>