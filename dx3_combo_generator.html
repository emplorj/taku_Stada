<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DX3 コンボジェネレーター - 卓スタダ</title>
  <meta name="robots" content="noindex">

  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.css">
  <link rel="stylesheet" href="css/dx3_combo_generator.css">

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
</head>

<body>
  <div id="header-placeholder"></div>
  <canvas id="particleCanvas"></canvas>

  <div class="main-content">
    <header class="main-header">
      <h1><i class="fa-solid fa-burst"></i> DX3 コンボジェネレーター</h1>
      <p class="subtitle">キャラシのURLを入力して、キャラシから引用することができるぞ！ここを触ってもキャラシに反映されるわけではないから要注意だ！</p>
    </header>

    <!-- ★★★ ここから使い方ガイドを追加 (最新版) ★★★ -->
    <details class="usage-guide plain-text-block">
      <summary>
        <div class="summary-content">
          <h2>DX3コンボジェネレーター、使いこなしてる？</h2>
          <p class="subtitle">面倒な計算はツールに任せて、最高のコンボを考えようぜ。</p>
        </div>
      </summary>
      <div class="content-wrapper">
        <p>
          コンボ計算とかチャットパレット作りとか、正直だるい。わかる。<br>だからこのツール作ったんだ。キャラシのURLさえあれば、<strong>データは一瞬で読み込める</strong>し、あとは直感的にいじるだけでOK。
        </p>
        <p>どうせなら、ツールのポテンシャル、限界まで引き出そうぜ。</p>

        <h3>基本の3ステップ。これだけ覚えれば大体OK。</h3>
        <h4>STEP 1: まずはキャラシをブチ込む。</h4>
        <ol>
          <li><strong>「キャラクターシートURL」</strong>に、自分のキャラシURLをコピペする。</li>
          <li><strong>「<i class="fas fa-cloud-download-alt"></i> 読込/引用」</strong>をGO。DBにデータがなければ、キャラシから引用するか聞いてくれる。</li>
          <li>確認出るから「OK」。これだけで、君のデータがリストに展開される。楽勝だろ。</li>
        </ol>

        <h4>STEP 2: コンボを組み立てる。</h4>
        <ol>
          <li><strong>「<i class="fa-solid fa-plus"></i> コンボを追加」</strong>で新しいコンボ欄を作る。</li>
          <li><strong>「<i class="fa-solid fa-check-double"></i>
              組合せ」</strong>で、使うエフェクトとアイテムを選ぶ。チェック入れるだけ。</li>
          <li>コンボ計算バーの<strong>「技能値」</strong>あたりを調整。大体は自動で賢くやってくれるけど、まあ、好みでいじってくれ。</li>
        </ol>

        <h4>STEP 3: パレットをコピー。終わり。</h4>
        <ol>
          <li>コンボの下に、もう<strong>チャットパレットが出来上がってる</strong>。説明文とダイス式の2段構えだ。</li>
          <li>それぞれの右にある<strong>コピーボタン<i class="fa-solid fa-paste"></i></strong> をクリック。</li>
          <li>あとはココフォリアに貼るだけ。マジでこれだけ。</li>
        </ol>

        <h3>もっと深く知りたい？ならアドバンス機能だ。</h3>
        <p>このツールのヤバさは、ここからかもしれない。</p>

        <h4><i class="fa-solid fa-database"></i> 全部保存。</h4>
        <ul>
          <li><strong>「<i class="fas fa-save"></i> 保存」</strong>: 作ったビルドは、URLに紐づけてDBに保存できる。データが飛ぶ心配はない。</li>
          <li><strong>「<i class="fas fa-cloud-download-alt"></i> 読込/引用」</strong>: 保存したビルドはいつでも一発で呼び出せる。セッション直前の準備も余裕。
          </li>
        </ul>
        <h4><i class="fa-solid fa-gear"></i> 「詳細設定」計算をして適用させよう。</h4>
        <p>
          ここがキモ。<strong>歯車ボタン<i class="fa-solid fa-gear"></i></strong>から、計算の裏側を全部入力できる。一度設定すれば、あとは全自動だ。
        </p>
        <ul>
          <li><strong>【重要】アイテム攻撃力の連携機能</strong>
            <ul>
              <li>アイテムの攻撃力設定は、リストの<strong>「攻撃力」欄</strong>と<strong>詳細設定の「ATK」タブ</strong>が<strong>完全に同期する</strong>。</li>
              <li>例えば、攻撃力欄に<code>LV*4+2</code>と入力すれば、詳細設定のATKが「固定値: 2」「Lv毎加算: 4」に自動で変わる。</li>
              <li>逆に、詳細設定をいじれば、それがリアルタイムで攻撃力欄の式に反映される。どっちからでも入力できるから、好きな方を使ってくれ。</li>
            </ul>
          </li>
          <li><strong>ダイス・固定値・追加攻撃力の定義</strong>
            <ul>
              <li><strong>固定値:</strong> コンボに乗る固定値を入力する。</li>
              <li><strong>Lv毎加算:</strong> LVで効果がスケールするやつはここ。「LV*2」なら「2」と入れれば、あとは勝手に計算してくれる。</li>
            </ul>
          </li>
          <li><strong>C値の下げ方</strong>
            <ul>
              <li><strong>固定値/Lv毎減算:</strong> C値を下げる効果を入力。シンプルに引いてくれる。</li>
              <li><strong>C値 下限:</strong> C値の最低ライン。「7」とかで設定しとけば、それ以下にはならない。計算ミスがなくて最高。</li>
            </ul>
          </li>
        </ul>

        <h4><i class="fa-solid fa-wand-magic-sparkles"></i> 色々賢くやってくれる機能。</h4>
        <ul>
          <li><strong>リアルタイム計算バー</strong>:
            ダイスとかC値とか、全部リアルタイムで自動計算される。数字にカーソル乗せれば、計算の内訳も見える。</li>
          <li><strong>対象・射程の自動判別＆手動上書き</strong>:
            どの効果が優先されるか、ルールに従ってツールが勝手に判断する。気に入らなければ「手動」に切り替えて上書きもできるぞ。</li>
          <li><strong>オーヴァードの義務教育「コンセントレイト」にも対応！:</strong>
            エフェクト名に「コンセントレイト」と入力するだけで、ツールがそれを認識して、C値を下げるための面倒な詳細設定を<strong>全部自動でやってくれる</strong>。マジで賢いだろ。
          </li>

          <li><strong>効果テキストの動的生成がえぐい</strong>:
            <ul>
              <li><strong>自動転記:</strong> エフェクトの効果、いい感じにまとめてくれる。</li>
              <li>
                <strong>解説のLv自動計算:</strong>
                これが本命。効果文に<code>攻撃力+[LV*5]</code>みたいに書いとけば、今のLVで自動計算してくれる。LV4なら「攻撃力+20」になる。<code>[LV]</code>って囲むのだけ忘れんな。
              </li>
            </ul>
          </li>
        </ul>
        <p>じゃ、あとはこのツールで自分だけの最強コンボ、作り込んでくれ。</p>
      </div>
    </details>
    <!-- ★★★ 使い方ガイドここまで ★★★ -->

    <script type="text/x-template" id="input-with-dropdown-template">
      <div class="input-with-dropdown" @click.stop>
        <input type="text" :value="value" @input="handleInput" :disabled="disabled">
        <span class="dropdown-arrow" @click.prevent.stop="toggleDropdown($event)" v-if="options.length > 0">▼</span>
        <ul v-if="isOpen && options.length > 0" class="dropdown-menu" :style="dropdownStyle">
          <li v-for="option in options" :key="option" @click="selectOption(option)">
            {{ option }}
          </li>
        </ul>
      </div>
    </script>

    <div id="dx3-app" class="plain-text-block" v-cloak>

      <div class="top-info-wrapper">
        <div class="db-sync-container">
          <div class="db-sync-block">
            <label class="db-url-input">
              <span>キャラクターシートURL:</span>
              <input type="text" v-model.trim="characterSheetUrl" placeholder="ゆとシート/Vampire-bloodのURLを入力"
                @keyup.enter="importFromSheet">
            </label>
            <div class="db-buttons">
              <button @click="loadFromDb" class="btn-load" :disabled="isBusy" title="DBから読込"><i
                  class="fas fa-cloud-download-alt"></i> 読込/引用</button>
              <button @click="overwriteSave" class="btn-save" :disabled="isBusy" title="上書き保存"><i
                  class="fas fa-save"></i> 保存</button>
              <button @click="copyToClipboard(shareUrl, $event)" class="btn-share" :disabled="!shareUrl"
                title="共有URLをコピー"><i class="fas fa-share-nodes"></i> 共有</button>
              <button @click="deleteFromDb" class="btn-delete" :disabled="isBusy" title="削除"><i
                  class="fas fa-trash-alt"></i> 削除</button>
            </div>
          </div>

        </div>
        <div class="character-info-grid">
          <label id="char-name-label">キャラクター名: <input type="text" v-model="characterName" placeholder="PC名"></label>

          <!-- 経験点項目をグループ化するdivを追加 -->
          <div class="xp-fields-group">
            <label id="total-xp-label">総経験点: <input type="number" v-model.number="totalXp"></label>
            <label id="other-xp-label">経験点増減: <input type="number" v-model.number="otherXp"
                title="アイテム購入以外の経験点増減をここに入力します"></label>
            <label id="used-xp-label">使用経験点: <input type="number" :value="usedXp" readonly class="text-right"></label>
            <label id="remaining-xp-label">残経験点: <input type="number" :value="totalXp + otherXp - usedXp" readonly
                class="text-right"></label>
          </div>
        </div>
        <!-- <p>タグをこの位置に移動 -->
        <p v-if="statusMessage" class="status-message" :class="{ 'error': statusIsError }">{{ statusMessage }}</p>
      </div>

      <h2 class="section-title"><i class="fa-solid fa-bolt"></i> エフェクト <span class="xp-display">(使用経験点: {{ effectXp
          }})</span></h2>
      <div class="table-wrapper">
        <table class="dx3-table effects-table">
          <thead>
            <tr>
              <th>名称</th>
              <th>Lv</th>
              <th>最大Lv</th>
              <th>タイミング</th>
              <th>技能</th>
              <th>難易度</th>
              <th>対象</th>
              <th>射程</th>
              <th>侵蝕値</th>
              <th>制限</th>
              <th>効果</th>
              <th>備考</th>
              <th>設定</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(effect, index) in effects">
              <td><input type="text" :value="effect.name"
                  @change="updateNameAndSync('effects', index, $event.target.value)"></td>
              <td class="text-right"><input type="number" :value="effect.level"
                  @input="updateAndSyncLevel('effects', index, $event.target.value)" min="1" class="text-right"></td>
              <td class="text-right"><input type="number" v-model.number="effect.maxLevel" min="1" class="text-right">
              </td>
              <td><input-with-dropdown v-model="effect.timing" :options="dropdownOptions.timing"></input-with-dropdown>
              </td>
              <td><input-with-dropdown v-model="effect.skill" :options="dropdownOptions.skill"></input-with-dropdown>
              </td>
              <td><input-with-dropdown v-model="effect.difficulty"
                  :options="dropdownOptions.difficulty"></input-with-dropdown></td>
              <td><input-with-dropdown v-model="effect.target" :options="dropdownOptions.target"></input-with-dropdown>
              </td>
              <td><input type="text" v-model="effect.range"></td>
              <td class="text-right"><input type="text" v-model="effect.cost" class="text-right"></td>
              <td><input-with-dropdown v-model="effect.limit" :options="dropdownOptions.limit"></input-with-dropdown>
              </td>
              <td><textarea v-model="effect.effect"></textarea></td>
              <td><textarea v-model="effect.notes"></textarea></td>
              <td class="action-cell">
                <button @click.stop="openEffectPanel($event, effect, 'effect', index)" class="setting-btn" title="詳細設定"
                  :disabled="isEssentialEffect(effect.name)"><i class="fa-solid fa-gear"></i></button>
                <button @click="removeEffect(index)" class="delete-btn" title="削除"
                  :disabled="isEssentialEffect(effect.name)"><i class="fa-solid fa-trash"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <button @click="addEffect" class="add-btn"><i class="fa-solid fa-plus"></i> エフェクトを追加</button>

      <h2 class="section-title"><i class="fa-solid fa-star"></i> イージーエフェクト <span class="xp-display">(使用経験点: {{
          easyEffectXp }})</span></h2>
      <div class="table-wrapper">
        <table class="dx3-table effects-table">
          <thead>
            <tr>
              <th>名称</th>
              <th>Lv</th>
              <th>最大Lv</th>
              <th>タイミング</th>
              <th>技能</th>
              <th>難易度</th>
              <th>対象</th>
              <th>射程</th>
              <th>侵蝕値</th>
              <th>制限</th>
              <th>効果</th>
              <th>備考</th>
              <th>設定</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(ee, index) in easyEffects">
              <td><input type="text" :value="ee.name"
                  @change="updateNameAndSync('easyEffects', index, $event.target.value)"></td>
              <td class="text-right"><input type="number" :value="ee.level"
                  @input="updateAndSyncLevel('easyEffects', index, $event.target.value)" min="1" class="text-right">
              </td>
              <td class="text-right"><input type="number" v-model.number="ee.maxLevel" min="1" class="text-right"></td>
              <td><input-with-dropdown v-model="ee.timing" :options="dropdownOptions.timing"></input-with-dropdown></td>
              <td><input-with-dropdown v-model="ee.skill" :options="dropdownOptions.skill"></input-with-dropdown></td>
              <td><input-with-dropdown v-model="ee.difficulty"
                  :options="dropdownOptions.difficulty"></input-with-dropdown></td>
              <td><input-with-dropdown v-model="ee.target" :options="dropdownOptions.target"></input-with-dropdown></td>
              <td><input type="text" v-model="ee.range"></td>
              <td class="text-right"><input type="text" v-model="ee.cost" class="text-right"></td>
              <td><input-with-dropdown v-model="ee.limit" :options="dropdownOptions.limit"></input-with-dropdown></td>
              <td><textarea v-model="ee.effect"></textarea></td>
              <td><textarea v-model="ee.notes"></textarea></td>
              <td class="action-cell">
                <button @click.stop="openEffectPanel($event, ee, 'easy', index)" class="setting-btn" title="詳細設定"><i
                    class="fa-solid fa-gear"></i></button>
                <button @click="removeEasyEffect(index)" class="delete-btn" title="削除"><i
                    class="fa-solid fa-trash"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <button @click="addEasyEffect" class="add-btn"><i class="fa-solid fa-plus"></i> イージーエフェクトを追加</button>

      <h2 class="section-title"><i class="fa-solid fa-shield-halved"></i> アイテム（別タイミングのバフ） <span
          class="xp-display">(使用経験点: {{
          itemXp }})</span></h2>
      <div class="table-wrapper">
        <table class="dx3-table items-table">
          <thead>
            <tr>
              <th>名称</th>
              <th>Lv</th>
              <th>種別</th>
              <th>技能</th>
              <th>命中</th>
              <th>攻撃力</th>
              <th>ガード値</th>
              <th>射程</th>
              <th title="アイテム自身の効果で使用時に侵蝕値が増える場合に記入します（エフェクトのコストは除く）">侵蝕値</th>
              <th>経験点</th>
              <th>備考</th>
              <th>設定</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(item, index) in items">
              <td><input type="text" :value="item.name"
                  @change="updateNameAndSync('items', index, $event.target.value)"></td>
              <td class="text-right"><input type="number" :value="item.level"
                  @input="updateAndSyncLevel('items', index, $event.target.value)" min="1" class="text-right"></td>
              <td><input type="text" v-model="item.type"></td>
              <td><input-with-dropdown v-model="item.skill" :options="dropdownOptions.skill"></input-with-dropdown></td>
              <td><input type="text" v-model="item.accuracy" @change="parseAccuracyFormula(item)" class="text-right">
              </td>
              <td><input type="text" v-model="item.attack" @change="parseAttackFormula(item)" class="text-right"></td>
              <td><input type="text" v-model="item.guard" @change="parseGuardFormula(item)" class="text-right"></td>
              <td><input type="text" v-model="item.range"></td>
              <td class="text-right"><input type="text" v-model="item.cost" class="text-right"></td>
              <td class="text-right"><input type="number" v-model.number="item.xp" class="text-right"></td>
              <td><textarea v-model="item.notes"></textarea></td>
              <td class="action-cell">
                <button @click.stop="openEffectPanel($event, item, 'item', index)" class="setting-btn" title="詳細設定"><i
                    class="fa-solid fa-gear"></i></button>
                <button @click="removeItem(index)" class="delete-btn" title="削除"><i
                    class="fa-solid fa-trash"></i></button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <button @click.stop="addItem" class="add-btn"><i class="fa-solid fa-plus"></i> アイテムを追加</button>

      <h2 class="section-title"><i class="fa-solid fa-cubes-stacked"></i> コンボデータ</h2>
      <div v-for="(combo, index) in processedCombos" class="combo-block">
        <div class="combo-header">
          <input type="text" v-model="combos[index].name" class="combo-name-input">
          <label class="combo-level-select">コンボLv:<select v-model.number="combos[index].comboLevelBonus">
              <option v-for="n in 6" :value="n-1">+{{ n-1 }}</option>
            </select></label>
          <button @click="moveComboUp(index)" class="move-btn" :disabled="index === 0" title="上へ移動"><i
              class="fa-solid fa-arrow-up"></i></button>
          <button @click="moveComboDown(index)" class="move-btn" :disabled="index === processedCombos.length - 1"
            title="下へ移動"><i class="fa-solid fa-arrow-down"></i></button>
          <button @click="removeCombo(index)" class="delete-btn"><i class="fa-solid fa-trash"></i></button>
        </div>
        <div class="combo-stats-bar">
          <div class="stat-item" :title="combo.diceBreakdown">ダイス: {{ combo.totalDice }}</div>
          <div class="stat-item" :title="combo.critBreakdown">C値: {{ combo.finalCrit }}</div>
          <div class="stat-item" :title="combo.achieveBreakdown">達成値: {{ combo.totalAchieve >= 0 ? '+' : '' }}{{
            combo.totalAchieve }}</div>
          <div class="stat-item target-setting">
            <span>対象:
              <input-with-dropdown
                :value="combos[index].targetMode === 'auto' ? combo.target : combos[index].manualTarget"
                :options="dropdownOptions.target" @input="combos[index].manualTarget = $event"
                :disabled="combos[index].targetMode === 'auto'"></input-with-dropdown>
            </span>
            <div class="mode-toggle">
              <button @click="combos[index].targetMode = 'auto'"
                :class="{active: combos[index].targetMode === 'auto'}">自動</button>
              <button @click="combos[index].targetMode = 'manual'"
                :class="{active: combos[index].targetMode === 'manual'}">手動</button>
            </div>
          </div>
          <div class="stat-item range-setting">
            <span>射程:
              <input-with-dropdown :value="combos[index].rangeMode === 'auto' ? combo.range : combos[index].manualRange"
                :options="dropdownOptions.range" @input="combos[index].manualRange = $event"
                :disabled="combos[index].rangeMode === 'auto'"></input-with-dropdown>
            </span>
            <div class="mode-toggle">
              <button @click="combos[index].rangeMode = 'auto'"
                :class="{active: combos[index].rangeMode === 'auto'}">自動</button>
              <button @click="combos[index].rangeMode = 'manual'"
                :class="{active: combos[index].rangeMode === 'manual'}">手動</button>
            </div>
          </div>
          <div class="stat-item timing-setting">
            <span>タイミング:
              <input-with-dropdown
                :value="combos[index].timingMode === 'auto' ? combo.timing : combos[index].manualTiming"
                :options="dropdownOptions.timing" @input="combos[index].manualTiming = $event"
                :disabled="combos[index].timingMode === 'auto'"></input-with-dropdown>
            </span>
            <div class="mode-toggle">
              <button @click="combos[index].timingMode = 'auto'"
                :class="{active: combos[index].timingMode === 'auto'}">自動</button>
              <button @click="combos[index].timingMode = 'manual'"
                :class="{active: combos[index].timingMode === 'manual'}">手動</button>
            </div>
          </div>
          <div class="stat-item base-ability-input">
            <span>技能値:</span>
            <select v-model="combos[index].baseAbility.skill">
              <option v-for="opt in dropdownOptions.baseSkillSelect" :value="opt">{{ opt }}</option>
            </select>
            <input type="number" v-model.number="combos[index].baseAbility.value">
          </div>

          <div class="stat-item" :title="combo.atkBreakdown">ATK: {{ combo.totalAtk }}</div>
          <div class="stat-item" :title="combo.costBreakdown">侵蝕値: {{ combo.totalCost }}</div>
        </div>
        <button @click.stop="openEffectSelectModal(index)" class="effect-select-button"><i
            class="fa-solid fa-check-double"></i> 組合せ ({{ (combos[index].effectNames ? combos[index].effectNames.length
          : 0) + (combos[index].itemNames ? combos[index].itemNames.length : 0) }}件選択中): {{ combo.compositionText
          }}</button>
        <div class="combo-details-grid">
          <div class="combo-textarea-wrapper">
            <div class="textarea-header"><label>フレーバーテキスト</label></div>
            <textarea v-model="combos[index].flavor" placeholder="例: 相手を焼き尽くす。"></textarea>
          </div>
          <div class="combo-textarea-wrapper">
            <div class="textarea-header">
              <label>効果解説</label>
              <div class="header-controls">
                <label class="advanced-parsing-switch" title="ONにすると、効果解説内の[LV*3]のような計算式を自動で解決して表示します。">
                  <input type="checkbox" v-model="combos[index].enableAdvancedParsing" class="switch">
                  <span>解説のLvを自動計算</span>
                </label>
                <div class="mode-toggle">
                  <button @click="combos[index].effectDescriptionMode = 'auto'"
                    :class="{active: combos[index].effectDescriptionMode === 'auto'}">自動転記</button>
                  <button @click="switchToManualMode(combos[index], index)"
                    :class="{active: combos[index].effectDescriptionMode === 'manual'}">手動編集</button>
                </div>
              </div>
            </div>
            <textarea v-if="combos[index].effectDescriptionMode === 'manual'"
              v-model="combos[index].manualEffectDescription" placeholder="ここに独自の効果解説を入力"></textarea>
            <textarea v-else readonly :value="combo.autoEffectText"></textarea>
          </div>
        </div>
        <div class="combo-palette-display">
          <div class="copy-container">
            <textarea readonly :value="combo.chatPalette.header"></textarea>
            <button @click="copyToClipboard(combo.chatPalette.header, $event)"><i
                class="fa-solid fa-paste"></i></button>
          </div>
          <div class="copy-container" v-if="combo.isMajorAction">
            <textarea readonly :value="combo.chatPalette.diceFormula" class="dice-formula-textarea"></textarea>
            <button @click="copyToClipboard(combo.chatPalette.diceFormula, $event)"><i
                class="fa-solid fa-paste"></i></button>
          </div>
        </div>

      </div>
      <button @click="addCombo" class="add-btn"><i class="fa-solid fa-plus"></i> コンボを追加</button>

      <div v-if="isPanelOpen" class="floating-panel" :style="panelStyle" @click.stop>
        <div class="panel-header">
          <h3>{{ editingEffect.name || '新規' }} 詳細設定</h3><button @click="closeEffectPanel" class="close-btn">×</button>
        </div>
        <div class="panel-body">
          <div class="modal-tabs"><button v-for="tab in modalTabs" :key="tab.key"
              :class="{ active: activeModalTab === tab.key }" @click="activeModalTab = tab.key">{{ tab.label }}</button>
          </div>
          <div class="modal-tab-content">
            <div v-show="activeModalTab !== 'crit'" class="panel-grid">
              <div class="input-group">
                <label>{{ activeModalTabLabel }} 固定値: <span class="input-example">(例: [LV*2<span
                      class="color-base">+4]</span>)</span></label>
                <div class="input-with-addon">
                  <input type="number" v-model.number="editingEffect.values[activeModalTab].base">
                  <button
                    v-if="activeModalTab === 'dice' || activeModalTab === 'accuracy' || activeModalTab === 'attack' || activeModalTab === 'guard'"
                    @click.stop="editingEffect.values[activeModalTab].isDiceInput = !editingEffect.values[activeModalTab].isDiceInput"
                    :class="{active: editingEffect.values[activeModalTab].isDiceInput}" class="dice-toggle-btn"
                    title="クリックでダイス表記のON/OFFを切替">D</button>
                </div>
              </div>
              <div class="input-group">
                <label>{{ activeModalTabLabel }} Lv毎加算: <span class="input-example">(例: [LV*<span
                      class="color-per-level">2</span>+4])</span></label>
                <div class="input-with-addon">
                  <input type="number" v-model.number="editingEffect.values[activeModalTab].perLevel">
                  <button
                    v-if="activeModalTab === 'dice' || activeModalTab === 'accuracy' || activeModalTab === 'attack' || activeModalTab === 'guard'"
                    @click.stop="editingEffect.values[activeModalTab].isPerLevelDiceInput = !editingEffect.values[activeModalTab].isPerLevelDiceInput"
                    :class="{active: editingEffect.values[activeModalTab].isPerLevelDiceInput}" class="dice-toggle-btn"
                    title="クリックでダイス表記のON/OFFを切替">D</button>
                </div>
              </div>
            </div>
            <div v-show="activeModalTab === 'crit'">
              <div class="input-group"><label>C値 固定値:</label><input type="number"
                  v-model.number="editingEffect.values.crit.base"></div>
              <div class="input-group"><label>C値 Lv毎減算:</label><input type="number"
                  v-model.number="editingEffect.values.crit.perLevel"></div>
              <div class="input-group"><label>C値 下限:</label><input type="number"
                  v-model.number="editingEffect.values.crit.min"></div>
            </div>
          </div>
        </div>
      </div>

      <div v-if="isEffectSelectModalOpen" class="modal-overlay">
        <div class="modal-content effect-select-modal" @click.stop>
          <div class="modal-header">
            <h3>コンボのエフェクトを選択</h3><button @click.stop="cancelEffectSelection" class="close-btn">×</button>
          </div>
          <div class="modal-body">
            <div class="option-group">
              <strong>エフェクト</strong>
              <label v-for="effect in effects" :key="effect.name + editingComboIndex + 'effect-select'"
                :class="{disabled: isEffectDisabled(effect)}"><input type="checkbox" :value="effect"
                  v-model="tempSelectedEffects" :disabled="isEffectDisabled(effect)"> {{ effect.name }} ({{
                effect.timing }})</label>
            </div>
            <div class="option-group">
              <strong>イージーエフェクト</strong>
              <label v-for="ee in easyEffects" :key="ee.name + editingComboIndex + 'ee-select'"
                :class="{disabled: isEffectDisabled(ee)}"><input type="checkbox" :value="ee"
                  v-model="tempSelectedEffects" :disabled="isEffectDisabled(ee)"> {{ ee.name }} ({{ ee.timing
                }})</label>
            </div>
            <div class="option-group">
              <strong>アイテム</strong>
              <label v-for="item in items" :key="item.name + editingComboIndex + 'item-select'"
                class="item-select-label">
                <input type="checkbox" :value="item" v-model="tempSelectedItems">
                <span>{{ item.name }} ({{ item.type }})</span>
                <button @click.stop="toggleShowInComboName(item)" :class="{active: isShowInComboName(item.name)}"
                  :disabled="!isItemSelected(item.name)" class="show-in-combo-btn"
                  title="クリックでコンボ名への表示／非表示を切替">コンボ</button>
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button @click.stop="cancelEffectSelection" class="cancel-btn">キャンセル</button>
            <button @click.stop="confirmEffectSelection">決定</button>
          </div>
        </div>
      </div>

      <div v-if="confirmation.show" class="modal-overlay">
        <div class="modal-content confirmation-modal" @click.stop>
          <div class="modal-header">
            <h3>{{ confirmation.title }}</h3>
          </div>
          <div class="modal-body">
            <p v-html="confirmation.message"></p>
          </div>
          <div class="modal-footer">
            <button @click="cancelConfirmation" class="cancel-btn">キャンセル</button>
            <button @click="confirmConfirmation">OK</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <button onclick="topFunction()" id="backToTopBtn" title="トップへ戻る">▲</button>
  <script src="js/common.js"></script>


  <script src="js/dx3_combo_generator.js"></script>
</body>

</html>